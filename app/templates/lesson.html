{% extends "base.html" %}

{% block title %}{{ lesson.topic }} | PyLearn{% endblock %}

{% block content %}

<div class="container mt-5">
    <div class="mb-4">
        <a href="{{ url_for('main.lessons_list', module_id=lesson.id_module) }}" class="text-muted text-decoration-none">
            &larr; Return to Module
        </a>
    </div>

    <h1 class="mb-4" style="color: var(--accent);">{{ lesson.topic }}</h1>

    <div class="lesson-content p-4" style="background-color: var(--bg-card); border-radius: 8px; border: 1px solid var(--border);">
        <div class="lesson-text" style="
            color: var(--text-main);
            font-family: 'Consolas', 'Monaco', 'Lucida Console', monospace;
            font-size: 1.15rem;
            line-height: 1.7;">

            {{ lesson.content | safe }}

        </div>

<style>
    .lesson-text, .lesson-text * {
        font-family: 'Consolas', 'Monaco', 'Lucida Console', monospace !important;
    }

    .lesson-text img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 20px 0;
    }

    .lesson-text pre {
        font-size: 1rem;
        background: #1e1e1e;
        padding: 15px;
        border-radius: 6px;
        border: 1px solid #333;
        font-family: 'Consolas', 'Monaco', 'Lucida Console', monospace !important;
    }
</style>
    </div>
    
    <div class="mt-5 d-flex justify-content-between">
        </div>
</div>

<hr class="my-5" style="border-color: var(--border);">

    <div class="quiz-section text-center">

        {% if lesson.quiz %}
            <div class="card p-4 mb-4" style="background-color: var(--bg-card); border: 1px solid var(--accent);">
                <h3 style="color: var(--text-main);">Quiz: {{ lesson.quiz.title }}</h3>
                <p class="text-muted">Test your knowledge based on this lesson.</p>

                <a href="#" class="btn-get-started" style="text-decoration: none; display: inline-block;">START QUIZ</a>

                {% if current_user.role == 'admin' %}
                    <div class="mt-4 pt-3 border-top border-secondary d-flex justify-content-center gap-3">
                        <a href="{{ url_for('main.create_quiz', id_lesson=lesson.id_lesson) }}" class="btn btn-outline-warning">
                            EDIT QUIZ
                        </a>

                        <form action="{{ url_for('main.delete_quiz', id_quiz=lesson.quiz.id_quiz) }}" method="post" onsubmit="return confirm('Delete this quiz?');">
                            <button type="submit" class="btn btn-outline-danger">DELETE QUIZ</button>
                        </form>
                    </div>
                {% endif %}
            </div>

        {% else %}
            {% if current_user.role == 'admin' %}
                <div class="admin-panel p-4 rounded" style="border: 2px dashed var(--text-muted);">
                    <h4 class="text-muted mb-3">No quiz attached to this lesson.</h4>
                    <a href="{{ url_for('main.create_quiz', id_lesson=lesson.id_lesson) }}" class="btn-get-started"
                       style="background-color: var(--bg-card); color: var(--accent); border: 2px solid var(--accent);">
                        + CREATE QUIZ
                    </a>
                </div>
            {% endif %}

        {% endif %}
    </div>

    <br><br>


{% endblock %}