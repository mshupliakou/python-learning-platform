{% extends "base.html" %}

{% block title %}{{ lesson.topic }} | PyLearn{% endblock %}

{# POPRAWKA: Przeniesienie styl√≥w do dedykowanego bloku w sekcji HEAD #}
{% block styles %}
<style>
    .lesson-text-container {
        background-color: var(--bg-card);
        border-radius: 8px;
        border: 1px solid var(--border);
        padding: 2rem;
        color: var(--text-main);
        font-family: 'Consolas', 'Monaco', 'Lucida Console', monospace;
        font-size: 1.15rem;
        line-height: 1.7;
    }

    .lesson-text-container * {
        font-family: inherit;
    }

    .lesson-text-container img {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 20px 0;
        display: block;
    }

    .lesson-text-container pre {
        font-size: 1rem;
        background: #1e1e1e;
        padding: 15px;
        border-radius: 6px;
        border: 1px solid #333;
        overflow-x: auto;
    }

    .quiz-card {
        background-color: var(--bg-card);
        border: 1px solid var(--accent);
        border-radius: 8px;
    }

    .admin-quiz-panel {
        border: 2px dashed var(--text-muted);
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
    }

    .back-link {
        color: var(--text-muted);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        transition: color 0.2s;
    }

    .back-link:hover {
        color: var(--accent);
    }
</style>
{% endblock %}

{% block content %}

<div class="container mt-5 mb-5">

    <div class="mb-4">
        <a href="{{ url_for('main.lessons_list', module_id=lesson.id_module) }}" class="back-link">
            &larr; Return to Module
        </a>
    </div>

    <h1 class="mb-4" style="color: var(--accent);">{{ lesson.topic }}</h1>

    <section class="lesson-text-container">
        {{ lesson.content | safe }}
    </section>

    <hr class="my-5" style="border-color: var(--border);">

    <section class="quiz-section text-center">

        {% if lesson.quiz %}
            <div class="card p-4 mb-4 quiz-card">
                <h2 style="color: var(--text-main);">Quiz: {{ lesson.quiz.title }}</h2>
                <p class="text-muted">Test your knowledge based on this lesson.</p>

                <div class="mt-3">
                    <a href="{{ url_for('main.quiz', id_quiz=lesson.quiz.id_quiz) }}"
                       class="btn-get-started"
                       style="text-decoration: none; display: inline-block;">
                       START QUIZ
                    </a>
                </div>

                {% if current_user.role == 'admin' %}
                    <div class="mt-4 pt-3 border-top border-secondary d-flex justify-content-center gap-3">
                        <a href="{{ url_for('main.create_quiz', id_lesson=lesson.id_lesson) }}"
                           class="btn btn-outline-warning">
                            EDIT QUIZ
                        </a>

                        <form action="{{ url_for('main.delete_quiz', id_quiz=lesson.quiz.id_quiz) }}" method="post"
                              onsubmit="return confirm('Delete this quiz?');">
                            <button type="submit" class="btn btn-outline-danger">DELETE QUIZ</button>
                        </form>
                    </div>
                {% endif %}
            </div>

        {% else %}
            {% if current_user.role == 'admin' %}
                <div class="d-flex justify-content-center">
                    <div class="admin-quiz-panel p-5 rounded text-center">
                        <h2 class="h4 text-muted mb-4">No quiz attached to this lesson.</h2>

                        <a href="{{ url_for('main.create_quiz', id_lesson=lesson.id_lesson) }}"
                           class="btn-get-started"
                           style="background-color: var(--accent); color: black; font-weight: bold; border-radius: 20px; padding: 10px 30px; text-decoration: none; display: inline-block;">
                            + CREATE QUIZ
                        </a>

                    </div>
                </div>
            {% endif %}

        {% endif %}
    </section>

</div>

{% endblock %}