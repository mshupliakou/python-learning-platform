{% extends "base.html" %}

{% block title %}Create Quiz | PyLearn{% endblock %}

{# POPRAWKA: Blok styles musi być NA ZEWNĄTRZ bloku content #}
{% block styles %}
<style>
    .editor-container {
        max-width: 900px;
        margin: 0 auto;
    }

    .input-dark {
        background-color: #1a1d24 !important;
        border: 1px solid var(--border) !important;
        color: var(--text-main) !important;
        padding: 12px;
    }

    .input-dark:focus {
        border-color: var(--accent) !important;
        box-shadow: 0 0 0 2px rgba(255, 94, 91, 0.2);
    }

    .input-dark::placeholder {
        color: #888 !important;
        opacity: 1;
    }

    .answer-group {
        background-color: #0f1115;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #333;
    }

    .form-check-input:checked {
        background-color: var(--accent);
        border-color: var(--accent);
    }

    .btn-dashed {
        border: 2px dashed rgba(255, 255, 255, 0.3);
        background-color: transparent;
        color: rgba(255, 255, 255, 0.6);
        border-radius: 15px;
        transition: all 0.3s ease;
    }

    .btn-dashed:hover {
        border-color: var(--accent);
        color: var(--accent);
        background-color: rgba(255, 94, 91, 0.05);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
</style>
{% endblock %}

{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/6.8.2/tinymce.min.js" referrerpolicy="origin"></script>

<div class="container mt-5 mb-5 editor-container">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 style="font-weight: bold; color: var(--text-main);">
            <span style="color: var(--accent);">QUIZ</span> EDITOR
        </h1>
        <a href="{{ url_for('main.view_lesson', id_lesson=lesson.id_lesson) }}" class="btn btn-outline-secondary">Cancel</a>
    </div>

    <div class="mb-5">
        <label for="quizTitle" class="text-muted fw-bold small mb-2">QUIZ TITLE</label>
        <input type="text" id="quizTitle" class="form-control input-dark form-control-lg"
               placeholder="Ex: Variables Quiz" value="{{ quiz.title if quiz else '' }}">
    </div>

    <div id="questionsContainer">
        </div>

    <button type="button" onclick="addQuestion()" class="btn btn-dashed w-100 py-4 mb-5"
            style="font-weight: bold; font-size: 1.2rem;">
        + ADD NEW QUESTION
    </button>

    <hr style="border-color: var(--border);">

    <div class="text-end">
        <button type="button" onclick="saveQuiz()" class="btn-get-started"
                style="background-color: var(--accent); color: black; border: none; font-weight: bold; padding: 10px 30px; border-radius: 20px;">
            {{ 'UPDATE QUIZ' if quiz else 'CREATE QUIZ' }}
        </button>
    </div>
</div>

<script>
    const CONFIG = {
        saveUrl: "{{ url_for('main.save_quiz', id_lesson=lesson.id_lesson) }}",
        redirectUrl: "{{ url_for('main.view_lesson', id_lesson=lesson.id_lesson) }}"
    };

    window.EXISTING_QUIZ = {% if quiz and quiz.questions %}
        [
            {% for q in quiz.questions %}
            {
                text: {{ q.question | tojson }},
                answers: [
                    {% for a in q.answers %}
                    {
                        text: {{ a.answer | tojson }},
                        is_correct: {{ 'true' if a.is_right else 'false' }}
                    },
                    {% endfor %}
                ]
            },
            {% endfor %}
        ]
    {% else %}
        []
    {% endif %};
</script>

<script src="{{ url_for('static', filename='js/quizes.js') }}"></script>
{% endblock %}