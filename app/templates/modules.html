{% extends "base.html" %}

{% block title %}Modules | PyLearn{% endblock %}

{% block content %}
<div class="container mt-5">

    <h1 class="text-center mb-5" style="font-weight: bold; letter-spacing: 2px;">
        AVAILABLE MODULES
    </h1>

    <div class="row">
        {% for course in courses %}
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card h-100 module-card">

                {% if current_user.is_authenticated and current_user.role == 'admin' %}

                <button type="button" class="edit-btn" title="Edit Module" aria-label="Edit Module"
                        data-bs-toggle="modal" data-bs-target="#editModal{{ course.id_module }}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-fill" viewBox="0 0 16 16" aria-hidden="true">
                      <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                    </svg>
                </button>

                <form action="{{ url_for('main.delete_module', module_id=course.id_module) }}" method="post"
                      onsubmit="return confirm('Are you sure?');">
                    <button type="submit" class="delete-btn" title="Delete Module" aria-label="Delete Module">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3-fill" viewBox="0 0 16 16" aria-hidden="true">
                          <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5m-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5M4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06m6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528M8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5"/>
                        </svg>
                    </button>
                </form>

                {% endif %}

                <img src="{{ url_for('static', filename='images/modules/' + (course.image_path if course.image_path else 'default_course.jpg')) }}"
                     class="card-img-top"
                     alt="{{ course.name }}"
                     style="height: 180px; object-fit: cover;">

                <div class="card-body d-flex flex-column">
                    <h2 class="card-title h5" style="color: var(--text-main); font-weight: bold;">
                        {{ course.name }}
                    </h2>
                    <p class="card-text flex-grow-1" style="color: var(--text-muted); font-size: 14px;">
                        {{ course.description[:100] }}...
                    </p>
                        <a href="{{ url_for('main.lessons_list', module_id=course.id_module) }}"
                           class="btn btn-outline-danger mt-3"
                           style="border-radius: 20px;">
                            Start Learning
                        </a>
                </div>
            </div>

            {% if current_user.is_authenticated and current_user.role == 'admin' %}
            <div class="modal fade" id="editModal{{ course.id_module }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content login-container" style="max-width: 500px; padding: 20px; text-align: left;">

                  <div class="modal-header border-0 pb-0">
                    <h2 class="modal-title w-100 text-center h1" style="margin: 0; font-size: 24px;">EDIT MODULE</h2>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" style="position: absolute; right: 20px; top: 20px;"></button>
                  </div>

                  <div class="modal-body pt-4">
                    <form action="{{ url_for('main.edit_module', module_id=course.id_module) }}" method="post" enctype="multipart/form-data">

                        <div class="input-group">
                          <label for="edit_name_{{ course.id_module }}">MODULE NAME</label>
                          <input type="text" id="edit_name_{{ course.id_module }}" name="name" required value="{{ course.name }}" style="background: #2b2b2b; color: white;">
                        </div>

                        <div class="input-group">
                          <label for="edit_desc_{{ course.id_module }}">DESCRIPTION</label>
                          <textarea id="edit_desc_{{ course.id_module }}" name="description" rows="5" required style="width: 100%; background: #2b2b2b; border: 1px solid var(--border); color: white; padding: 10px;">{{ course.description }}</textarea>
                        </div>

                        <div class="input-group">
                          <label for="edit_img_{{ course.id_module }}">CHANGE IMAGE (Optional)</label>
                          <input type="file" id="edit_img_{{ course.id_module }}" name="image" accept="image/*">
                        </div>

                        <button type="submit" class="mt-4">SAVE CHANGES</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            {% endif %}

        </div>
        {% else %}
        <div class="col-12 text-center">
            <p class="text-muted">No modules found. Please check back later!</p>
        </div>
        {% endfor %}

        {% if current_user.is_authenticated and current_user.role == 'admin' %}
            <div class="col-md-6 col-lg-3 mb-4">
                <a href="#" class="text-decoration-none" data-bs-toggle="modal" data-bs-target="#createModuleModal">
                    <div class="card h-100 module-card d-flex justify-content-center align-items-center"
                         style="border: 2px dashed var(--accent); background: transparent; min-height: 350px;">

                        <div class="text-center">
                            <span style="font-size: 80px; color: var(--accent); line-height: 1;">+</span>
                            <h2 class="mt-2 h4" style="color: var(--text-main);">New Module</h2>
                        </div>

                    </div>
                </a>
            </div>
        {% endif %}
    </div>

    <div class="modal fade" id="createModuleModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">

        <div class="modal-content login-container" style="max-width: 500px; padding: 20px;">

          <div class="modal-header border-0 pb-0">
            <h2 class="modal-title w-100 text-center h1" style="margin: 0;">NEW MODULE</h2>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" style="position: absolute; right: 20px; top: 20px;"></button>
          </div>

          <div class="modal-body pt-4">
            <form action="{{ url_for('main.create_module') }}" method="post" enctype="multipart/form-data">

                <div class="input-group">
                  <label for="name">MODULE NAME</label>
                  <input type="text" id="name" name="name" required placeholder="Advanced Python">
                </div>

                <div class="input-group">
                  <label for="description">DESCRIPTION</label>
                  <textarea id="description" name="description" rows="5" required
                            style="width: 100%; background-color: #0f1115; border: 1px solid var(--border); color: var(--text-main); padding: 12px; font-size: 16px;"></textarea>
                </div>

                <div class="input-group">
                  <label for="image">COVER IMAGE</label>
                   <input type="file" id="image" name="image" accept="image/*">
                </div>

                <button type="submit" class="mt-4">CREATE MODULE</button>

            </form>
          </div>

        </div>
      </div>
    </div>

</div>
{% endblock %}